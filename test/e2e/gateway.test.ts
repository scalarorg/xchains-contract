import { describe, it, expect } from "bun:test";

import { createPublicClient, http, decodeErrorResult } from "viem";
import { sepolia } from "viem/chains";
import { projectEnv } from "./envs";
import GATEWAY_ABI from "./data/gateway-abi";

const publicClient = createPublicClient({
  chain: sepolia,
  transport: http(projectEnv.RPC_URL),
});

describe("Gateway", () => {
  it("should execute", async () => {
    try {
      const res = await publicClient.simulateContract({
        address: projectEnv.GATEWAY_CONTRACT_ADDRESS as `0x${string}`,
        abi: GATEWAY_ABI,
        functionName: "execute",
        args: [`0x${EXECUTE_DATA}`],
      });
      console.log(res);
    } catch (e: any) {
      if (e.cause?.data) {
        try {
          const decodedError = decodeErrorResult({
            abi: GATEWAY_ABI,
            data: e.cause.data,
          });
          console.log("Decoded Error:", {
            errorName: decodedError.errorName,
            args: decodedError.args,
          });
        } catch (decodeError) {
          console.log("Error decoding:", decodeError);
        }
      }
      console.log("Original error:", e);
    }
  });
});

const EXECUTE_DATA =
  "000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000007a000000000000000000000000000000000000000000000000000000000000007400000000000000000000000000000000000000000000000000000000000aa36a700000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000000034b6f70ea9c9556453ab0f8b65003118239719ae504bd19559f21e0f3c5021479bac7d491529a703e5af3336c32ff64b73b0cd0ed25cc61a43567b25741dde8b6f68541762276895b200060168ccdf90abb8c621b0229739b9f1dc9b1903e20aa0000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000013617070726f7665436f6e747261637443616c6c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013617070726f7665436f6e747261637443616c6c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013617070726f7665436f6e747261637443616c6c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000360000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001f98c06d8734d5a9ff0b53e3294626e62e4d232c2ccb86603d404ee7a1982d7dddce2416aa1e334808027e85a574fd4beb642d457c1b7e6978cb930a0e42b632773e564be64eb64da491aee447a4fa836ead8a0400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010626974636f696e2d746573746e65743400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a30783133304334383130443537313430653145363239363763424637343243614561453931623665634500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001f98c06d8734d5a9ff0b53e3294626e62e4d232c70859da59f66b872df9495245c3f69a35137d3a7b7ef7b255557e3d3065c95a3a1c6f8acb05f02085139c3cd4a16c18edc55fa36cc49551c4caf611ce3f37daa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010626974636f696e2d746573746e65743400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a30783133304334383130443537313430653145363239363763424637343243614561453931623665634500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000b91e3a8ef862567026d6f376c9f3d6b814ca43373542e25e3fe2e4082f9dff6769222d2a40b67eafe49660fd7edb26fffdfdab177061fd3d540a3e43f3ea5026d591ec927e13b5918d1e8d6b3c13f33faad09c1800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010626974636f696e2d746573746e65743400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a30783234613164423537466133656341466362614439316436456630363834333961634565416530393000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000ea6000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000004000000000000000000000000324a5f8ff56f04a99f6af55a5de23e4f48901b7200000000000000000000000048a200f5cc43494e98b862f78ddf839ada5e08550000000000000000000000006c8a7a322bb78b4c209aa6e3713f30f5ea95a94c000000000000000000000000c28881f4cc390ad5484f008ee2c3374754160a9d00000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000009c4000000000000000000000000000000000000000000000000000000000000075300000000000000000000000000000000000000000000000000000000000004e2000000000000000000000000000000000000000000000000000000000000027100000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000041010be80802ab74ed3eb607339edf2c126d194d41acf6d170f34fd2dab83f75a86c636a79a0a5a7fddfb24c2410f6cb34bf7549e268856766c7238b3cd3dcbb3c1b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041ff9e30f34c8955cca8514d1570f78c54cba788b3eaa14f687f828b72278b0c5713b3b8bc8f1822513ec2da0f7cf470be788224283450c845e4bebdc3b7a612971b00000000000000000000000000000000000000000000000000000000000000";
